<InvoiceEditScreen>:
    name: 'invoice_edit'

    BoxLayout:
        orientation: 'vertical'

        MDTopAppBar:
            id: screen_title
            title: "Редактирование накладной"
            left_action_items: [["arrow-left", lambda x: root.cancel_edit()]]
            right_action_items: [["plus", lambda x: root.add_product()]]
            elevation: 2

        MDBoxLayout:
            orientation: 'vertical'
            padding: "8dp"

            MDScrollView:
                do_scroll_x: False
                size_hint_y: 0.9

                MDList:
                    id: invoice_items
                    padding: "8dp"

            # Нижняя часть - итого и кнопка сохранения
            MDCard:
                orientation: 'vertical'
                size_hint_y: None
                height: "80dp"
                padding: "8dp"
                md_bg_color: 0.95, 0.95, 0.95, 1

                # Итоговая сумма и кнопка сохранения на одной строке
                MDBoxLayout:
                    orientation: 'horizontal'
                    spacing: "8dp"
                    size_hint_y: 1

                    # Кнопка ИТОГО с возможностью переключения статуса
                    MDRaisedButton:
                        id: total_button
                        text: "ИТОГО: 0.00"
                        font_style: "H6"
                        size_hint_x: 0.5
                        md_bg_color: 0.2, 0.7, 0.2, 1  # Начальный цвет - зеленый (Оплачено)
                        on_release: root.toggle_payment_status()

                    # Кнопка сохранения
                    MDFillRoundFlatIconButton:
                        text: "СОХРАНИТЬ"
                        icon: "content-save"
                        size_hint_x: 0.5
                        on_release: root.save_changes()